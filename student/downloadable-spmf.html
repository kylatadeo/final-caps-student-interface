<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Progress Monitoring Flowchart</title>

  <link rel="stylesheet" href="../styles/general.css">
  <link rel="stylesheet" href="../student/styles/downloadable-spmf.css">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon" />

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
</head>
<body>
  
  <div style="display: flex; flex:1; justify-content: end; align-items: center; gap: 20px; margin: 20px 20px 0 30px ;">
    <div style="margin-right: auto; font-style: italic" class="txt-14 txt-gray1">
      Fill in the required fields, click them to activate the text boxes, and upload your e-signature.
    </div>
    <input type="file" id="uploadBtn" accept="image/*">
    <label for="uploadBtn" class="bg-blue">
      <span class="material-symbols-outlined">
          upload</span>
      <span class="txt-14 txt-semibold">Upload your E-sign</span>
    </label>
    <div style="display: flex; gap: 15px; align-items: center;">
      <button id="download-spmf-button" class="button bg-green txt-white">
      <span class="material-symbols-outlined">
          download</span>
      <span class="txt-14 txt-semibold">Download SPMF</span>
      </button>
    </div>
    <button class="close-button bg-red txt-white" id="closeReport">
      <span class="material-symbols-outlined">
        close</span>
    </button>
  </div>

  <div class="spmf-body">
    <img class="background" src="SPMF arrows.png">
    <div class="container">
      <div class="student-info">
        <div style="display: flex; gap: 3px; width: 323px;">
          <div>Name:</div>
          <div style="width: 75%;" class="txt-13 border-bottom">
            <input class="txt-17" type="text" style="width: 100%;">
          </div>
        </div>
        <div style="display: flex; gap: 3px; width: 315px;">
          <div>Student No.:</div>
          <div style="width: 55%;" class="txt-13 border-bottom">
            <input class="txt-17" type="text" style="width: 100%;">
          </div>
        </div>
        <div style="display: flex; gap: 3px; width: 240px;">
          <div>SAIS No.:</div>
          <div style="width: 55%;" class="txt-13 border-bottom">
            <input class="txt-17" type="text" style="width: 100%;">
          </div>
        </div>
        <div style="display: flex; gap: 3px; width: 240px;">
          <div>Degree:</div>
          <div style="width: 65%;" class="txt-12 border-bottom">BS Industrial Engineering</div>
        </div>
      </div>
      <div class="pledge">
        <div>
          I hereby declare, upon my honor, that I will accomplish this form with utmost honesty
        </div>
        <div style="width: 25%;" class="border-bottom"></div>
      </div>
      <div style="
      transform: translate(933px, -40px);
      font-weight: 500;">
        Signature</div>
      
      <div class="spmf-container">
        <div>
          <div class="title">
            <div>FOUR-YEAR CURRICULUM LEADING TO THE DEGREE OF</div>
            <div>BACHELOR OF SCIENCE IN INDUSTRIAL ENGINEERING</div>
            <div>Effective AY 2018-19</div>
          </div>

          <table class="spmf-table">
            <thead>
              <td colspan="2">First Year</td>
              <td colspan="3">Second Year</td>
              <td colspan="2">Third Year</td>
              <td colspan="2">Fourth Year</td>
            </thead>
            <tr>
              <td>1st Sem</td>
              <td>2nd Sem</td>
              <td>1st Sem</td>
              <td>2nd Sem</td>
              <td>Midyear Term</td>
              <td>1st Sem</td>
              <td>2nd Sem</td>
              <td>1st Sem</td>
              <td>2nd Sem</td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <div id="ENSC 12 (1)" class="prereq-course">ENSC 12</div>
              </td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>
                <div id="ARTS 1" class="course-pill">ARTS 1</div>
              </td>
              <td>
                <div id="KAS 1/HIST 1" class="course-pill">HIST 1 / KAS 1</div>
              </td>
              <td>
                <div id="PI 10" class="course-pill">PI 10</div>
              </td>
              <td>
                <div id="ETHICS 1" class="course-pill">ETHICS 1</div>
              </td>
              <td>
                <div id="IE 198" class="course-pill">IE 198*</div>
              </td>
              <td></td>
              <td>
                <div id="ENSC 16" class="course-pill">ENSC 16</div>
              </td>
              <td>
                <div id="Cognate (1)" class="course-pill">Technical Cognate</div>
              </td>
              <td>
                <div id="Cognate (2)" class="course-pill">Technical Cognate</div>
              </td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td>
                <div id="MATH 28 (1)"class="prereq-course">MATH 28</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <div id="PHYS 51 and MATH 28" class="prereq-course">PHYS 51 and MATH 28</div>
              </td>
              <td></td>
              <td>
                <div id="IE 31 (1)" class="prereq-course">IE 31</div>
              </td>
            </tr>
            <tr>
              <td>
                <div id="STS 1" class="course-pill">STS 1</div>
              </td>
              <td>
                <div id="GE Elective (1)" class="course-pill">GE</div>
              </td>
              <td>
                <div id="ENSC 21" class="course-pill">ENSC 21</div>
              </td>
              <td></td>
              <td></td>
              <td>
                <div id="ENSC 13" class="course-pill">ENSC 13</div>
              </td>
              <td>
                <div id="ENSC 14a" class="course-pill">ENSC 14a</div>
              </td>
              <td>
                <div id="ENG 10" class="course-pill">ENG 10</div>
              </td>
              <td>
                <div id="IE 90" class="course-pill">IE 90</div>
              </td>
            </tr>
            <tr>
              <td></td>
              <td>
                <div id="ENSC 11" class="course-pill">ENSC 11</div>
              </td>
              <td></td>
              <td>
                <div id="ENSC 12" class="course-pill">ENSC 12</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <div id="IE 199" class="course-pill">IE 199*</div>
              </td>
              <td>
                <div id="COMM 10" class="course-pill">COMM 10</div>
              </td>
            </tr>
            <tr>
              <td></td>
              <td>
                <div id="PHYS 51 (1)" class="prereq-course">PHYS 51</div>
              </td>
              <td></td>
              <td>
                <div id="ENSC 10.1" class="course-pill">ENSC 10.1</div>
              </td>
              <td></td>
              <td>
                <div id="ABE 43" class="course-pill">ABE 43</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>
                <div id="MATH 27" class="course-pill">MATH 27</div>
              </td>
              <td>
                <div id="MATH 28" class="course-pill">MATH 28</div>
              </td>
              <td>
                <div id="IE 141" class="course-pill">IE 141</div>
              </td>
              <td>
                <div id="IE 142" class="course-pill">IE 142</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <div id="GE Elective (2)" class="course-pill">GE</div>
              </td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <div id="STAT 101 (1)" class="prereq-course">STAT 101</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <div id="IE 143" class="course-pill">IE 143</div> 
              </td>
              <td>
                <div id="IE 144" class="course-pill">IE 144</div> 
              </td>
              <td></td>
              <td>
                <div id="GE Elective (3)" class="course-pill">GE</div>
              </td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <div id="IE 158" class="course-pill">IE 158</div>
              </td>
              <td>
                <div id="MATH 27 (1)"class="prereq-course">MATH 27</div>
              </td>
            </tr>
            <tr>
              <td>
                <div id="IE 10" class="course-pill">IE 10</div>
              </td>
              <td>
                <div id="IE 31" class="course-pill">IE 31</div>
              </td>
              <td>
                <div id="IE 132" class="course-pill">IE 132</div>
              </td>
              <td>
                <div id="IE 151" class="course-pill">IE 151</div>
              </td>
              <td></td>
              <td>
                <div id="IE 152" class="course-pill">IE 152</div>
              </td>
              <td>
                <div id="IE 184" class="course-pill">IE 184</div>
              </td>
              <td>
                <div id="IE 185" class="course-pill">IE 185</div>
              </td>
              <td>
                <div id="EE 1" class="course-pill">EE 1</div>
              </td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td> 
                <div id="MATH 28 (2)" class="prereq-course">MATH 28</div>
              </td>
              <td></td>
              <td>
                <div id="MATH 28 (3)" class="prereq-course">MATH 28</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>
                <div id="PHYS 51" class="course-pill">PHYS 51</div>
              </td>
              <td>
                <div id="IE 21" class="course-pill">IE 21</div>
              </td>
              <td>
                <div id="IE 125" class="course-pill">IE 125</div>
              </td>
              <td>
                <div id="IE 150" class="course-pill">IE 150</div>
              </td>
              <td></td>
              <td>
                <div id="ENSC 26" class="course-pill">ENSC 26</div>
              </td>
              <td>
                <div id="IE 164" class="course-pill">IE 164</div>
              </td>
              <td>
                <div id="IE 165" class="course-pill">IE 165</div>
              </td>
              <td></td>
            </tr>
            <tr>
              <td>
                <div id="PHYS 51.1" class="course-pill">PHYS 51.1</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <div id="IE 132 (1)" class="prereq-course">IE 132</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>
                <div id="CHEM 18" class="course-pill">CHEM 18</div>
              </td>
              <td>
                <div id="STAT 101" class="course-pill">STAT 101</div>
              </td>
              <td></td>
              <td>
                <div id="MGT 111" class="course-pill">MGT 111</div>
              </td>
              <td></td>
              <td>
                <div id="IE 134" class="course-pill">IE 134</div>
              </td>
              <td>
                <div id="IE 136" class="course-pill">IE 136</div>
              </td>
              <td>
                <div id="IE 200 (1)" class="course-pill">IE 200*</div>
              </td>
              <td>
                <div id="IE 200 (2)" class="course-pill">IE 200*</div>
              </td>
            </tr>
            <tr>
              <td>
                <div id="CHEM 18.1" class="course-pill">CHEM 18.1</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <div id="IE 200B (1)" class="course-pill">IE 200b*</div>
              </td>
              <td>
                <div id="IE 200B (2)" class="course-pill">IE 200b*</div>
              </td>
            </tr>
            <tr>
              <td>
                <div id="HK 11" class="course-pill">HK 11</div>
              </td>
              <td>
                <div id="HK 12 (1)" class="course-pill">HK 12 or 13</div>
              </td>
              <td>
                <div id="HK 12 (2)" class="course-pill">HK 12 or 13</div>
              </td>
              <td>
                <div id="HK 12 (3)" class="course-pill">HK 12 or 13</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td>
                <div id="IE 200C (1)" class="course-pill">IE 200c*</div>
              </td>
              <td>
                <div id="IE 200C (2)" class="course-pill">IE 200c*</div>
              </td>
            </tr>
            <tr>
              <td>
                <div id="NSTP 1" class="course-pill">NSTP 1</div>
              </td>
              <td>
                <div id="NSTP 2" class="course-pill">NSTP 2</div>
              </td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
            <tr>
              <td>20 Units</td>
              <td>21 Units</td>
              <td>19 Units</td>
              <td>20 Units</td>
              <td>3 Units</td>
              <td>18 Units</td>
              <td>20 Units</td>
              <td>19 Units</td>
              <td>20 Units</td>
            </tr>
          </table>
          <div class="bottom-info">
            <div>*Prerequisite: Consent of Instructor (COI)</div>
            <div>Total: 160 Units</div>
          </div>
          <div class="adviser-sign">
            <div>Adviser's <br>Signature</div>
            <div>Adviser's <br>Signature</div>
            <div>Adviser's <br>Signature</div>
            <div>Adviser's <br>Signature</div>
            <div>Adviser's <br>Signature</div>
            <div>Adviser's <br>Signature</div>
            <div>Adviser's <br>Signature</div>
            <div>Adviser's <br>Signature</div>
            <div>Adviser's <br>Signature</div>
          </div>
        </div>
      
        <div>
          <table class="extra-table">
            <thead>
              <td colspan="2">Extra Subjects</td>
            </thead>
            <tr>
              <td>Subject</td>
              <td>Sem/Year</td>
            </tr>
            <tr>
              <td><input class="txt-17" type="text" style="width: 100%;"></td>
              <td><input class="txt-17" type="text" style="width: 100%;"></td>
            </tr>
            <tr>
              <td><input class="txt-17" type="text" style="width: 100%;"></td>
              <td><input class="txt-17" type="text" style="width: 100%;"></td>
            </tr>
            <tr>
              <td><input class="txt-17" type="text" style="width: 100%;"></td>
              <td><input class="txt-17" type="text" style="width: 100%;"></td>
            </tr>
            <tr>
              <td><input class="txt-17" type="text" style="width: 100%;"></td>
              <td><input class="txt-17" type="text" style="width: 100%;"></td>
            </tr>
            <tr>
              <td><input class="txt-17" type="text" style="width: 100%;"></td>
              <td><input class="txt-17" type="text" style="width: 100%;"></td>
            </tr>
          </table>
        </div>
      </div>
    </div>

    <div class="e-sign">
      <img id="eSign">
    </div>

    <div class="overlay">
      <div>Thesis Track</div>
      <div>Innovationeering <br>Track</div>
      <div>Engineering Industry Research Track</div>
    </div>

    <div class="legend">
      <span class="legend-title">LEGEND:</span>
      <div class="legend-item">
        <div class="line-coreq"></div>
        <span>corequisite</span>
      </div>
      <div class="legend-item">
        <div class="line-prereq"></div>
        <span>prerequisite</span>
      </div>
    </div>
  </div> 
  <script>
    document.getElementById("download-spmf-button").addEventListener("click", async () => {
      const { jsPDF } = window.jspdf;
      const node = document.querySelector(".spmf-body");

      // Small delay to ensure rendering
      await new Promise(r => setTimeout(r, 50));

      // 2. Convert the node (with clones) to PNG
      try {
        const dataUrl = await domtoimage.toPng(node, {
            width: 1280,
            height: 1650,
          style: { transform: 'scale(1)' }
        });

        // 4. Generate PDF
        const pdf = new jsPDF("p", "mm", "a4");
        const img = new Image();
        img.src = dataUrl;
        img.onload = () => {
          const pageWidth = pdf.internal.pageSize.getWidth();
          const imgHeight = (img.height * pageWidth) / img.width;
          pdf.addImage(dataUrl, "PNG", 0, 0, pageWidth, imgHeight);
          pdf.save("spmf.pdf");
        };
      } catch (err) {
        console.error("Error generating PDF:", err);
        alert("Error generating PDF: Please upload your e-signature first.");
      }
    });

    document.querySelector(".close-button").addEventListener("click", () => {
    // Access the parent page and hide the overlay
      window.parent.document.getElementById("spmfPreviewOverlay").classList.add("hidden");
      window.parent.document.getElementById("previewIframe").src = "";
    });

    const uploadBtn = document.getElementById("uploadBtn");
    const eSign = document.getElementById("eSign");

    uploadBtn.addEventListener("change", function(event) {
      const file = event.target.files[0];
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = function(e) {
          eSign.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
  </script>
</body>
</html>
